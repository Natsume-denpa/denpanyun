<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URLマネージャー</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        input[type="text"] {
            width: calc(100% - 22px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        input[type="file"] {
            margin-bottom: 10px;
        }
        button, .file-button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            display: inline-block;
            text-align: center;
            text-decoration: none;
        }
        #registerButton {
            background-color: #5cb85c;
        }
        #checkButton {
            background-color: #0275d8;
        }
        #deleteButton {
            background-color: #d9534f;
        }
        #saveButton {
            background-color: #f0ad4e;
        }
        #showGuideButton {
            background-color: #007bff;
        }
        #hideGuideButton {
            background-color: #6c757d;
        }
        .list-delete-btn {
            background-color: #d9534f;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            padding: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            word-break: break-all;
        }
        #message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
        .success {
            background-color: #dff0d8;
            color: #3c763d;
        }
        .error {
            background-color: #f2dede;
            color: #a94442;
        }
        .info {
            background-color: #d9edf7;
            color: #31708f;
        }
        #guideSection {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        #guideSection ul {
            padding-left: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>URLマネージャー</h1>
    <p>既存のJSONファイルを読み込むか、URLを直接登録してください。</p>

    <button id="showGuideButton" style="margin-bottom: 15px;">使い方ガイドを表示</button>

    <div id="guideSection" style="display: none;">
        <h3>URLマネージャーの使い方</h3>
        <hr>
        <h4>1. 初期設定とURLの登録</h4>
        <p>ツールを開くと、すぐにURLの登録ができます。<strong>「ここにURLを入力」</strong>に登録したいURLを貼り付け、<strong>「登録」</strong>ボタンをクリックしてください。追加したURLは、下にある<strong>「現在のURLリスト」</strong>に表示されます。</p>
        <h4>2. 登録済みURLの確認と操作</h4>
        <ul>
            <li><strong>URLの確認</strong>: 登録済みか確認したいURLを入力ボックスに入力し、<strong>「確認」</strong>ボタンを押します。リストを直接見て確認することもできます。</li>
            <li><strong>URLの検索</strong>: <strong>「URLを検索」</strong>ボックスに、探したいURLの一部を入力すると、リストがリアルタイムで絞り込まれます。</li>
            <li><strong>URLの削除</strong>: リスト内の各URLの右側にある<strong>「削除」</strong>ボタンをクリックするか、入力ボックスにURLを貼り付けて<strong>「削除」</strong>ボタンを押すと、リストから削除されます。</li>
        </ul>
        <h4>3. JSONファイルの保存と読み込み</h4>
        <ul>
            <li><strong>ファイルの保存</strong>: <strong>「現在のURLリストを保存」</strong>ボタンをクリックすると、現在のリスト内容がJSONファイルとしてダウンロードされます。</li>
            <li><strong>ファイルの読み込み</strong>: <strong>「ファイルの読み込み」</strong>にある<strong>「ファイルを選択」</strong>ボタンから、以前保存したJSONファイルを選択すると、リストが読み込まれます。</li>
        </ul>
        <button id="hideGuideButton" style="margin-top: 10px;">ガイドを閉じる</button>
    </div>

    <h3>1. ファイルの読み込み</h3>
    <input type="file" id="fileInput" accept=".json">

    <h3>2. URLの登録/確認/削除</h3>
    <input type="text" id="urlInput" placeholder="ここにURLを入力">
    <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 10px;">
        <button id="registerButton">登録</button>
        <button id="checkButton">確認</button>
        <button id="deleteButton">削除</button>
    </div>

    <h3>3. 現在のURLリスト</h3>
    <input type="text" id="searchInput" placeholder="URLを検索">
    <div id="urlListDisplay">
    </div>

    <h3>4. JSONファイルの保存</h3>
    <button id="saveButton">現在のURLリストを保存</button>

    <div id="message"></div>
</div>

<script>
    const fileInput = document.getElementById('fileInput');
    const urlInput = document.getElementById('urlInput');
    const registerButton = document.getElementById('registerButton');
    const checkButton = document.getElementById('checkButton');
    const deleteButton = document.getElementById('deleteButton');
    const saveButton = document.getElementById('saveButton');
    const messageDiv = document.getElementById('message');
    const searchInput = document.getElementById('searchInput');
    const urlListDisplay = document.getElementById('urlListDisplay');

    const showGuideButton = document.getElementById('showGuideButton');
    const hideGuideButton = document.getElementById('hideGuideButton');
    const guideSection = document.getElementById('guideSection');

    let urlList = [];

    // URLの正規表現チェック
    function isValidUrl(url) {
        try {
            new URL(url);
            return true;
        } catch (e) {
            return false;
        }
    }

    // メッセージの表示
    function showMessage(msg, type) {
        messageDiv.textContent = msg;
        messageDiv.className = `message ${type}`;
    }

    // URLリストを画面に表示する関数
    function renderUrlList(list) {
        urlListDisplay.innerHTML = '';
        if (list.length === 0) {
            urlListDisplay.innerHTML = '<p style="text-align: center; color: #6c757d;">登録済みのURLはありません。</p>';
            return;
        }
        const ul = document.createElement('ul');
        ul.style.listStyleType = 'none';
        ul.style.padding = '0';

        list.forEach((url, index) => {
            const li = document.createElement('li');
            li.className = 'list-item';

            const urlText = document.createElement('span');
            urlText.textContent = url;
            li.appendChild(urlText);

            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = '削除';
            deleteBtn.className = 'list-delete-btn';
            deleteBtn.onclick = () => {
                const urlIndex = urlList.indexOf(url);
                if (urlIndex > -1) {
                    urlList.splice(urlIndex, 1);
                    showMessage('URLをリストから削除しました。保存するには「保存」ボタンを押してください。', 'success');
                    renderUrlList(urlList);
                    searchInput.value = '';
                }
            };
            li.appendChild(deleteBtn);

            ul.appendChild(li);
        });
        urlListDisplay.appendChild(ul);
    }

    // ファイル読み込みイベントリスナー
    fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (!file) {
            showMessage('ファイルが選択されていません。', 'error');
            return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                urlList = JSON.parse(e.target.result);
                showMessage('JSONファイルを読み込みました。', 'success');
                renderUrlList(urlList);
            } catch (error) {
                showMessage('JSONファイルの形式が正しくありません。', 'error');
            }
        };
        reader.readAsText(file);
    });

    // 登録ボタンのイベントリスナー
    registerButton.addEventListener('click', () => {
        const url = urlInput.value.trim();
        if (!url) {
            showMessage('URLを入力してください。', 'error');
            return;
        }
        if (!isValidUrl(url)) {
            showMessage('有効なURLを入力してください。', 'error');
            return;
        }
        if (urlList.includes(url)) {
            showMessage('このURLはすでに登録済みです。', 'info');
        } else {
            urlList.push(url);
            showMessage('URLをリストに登録しました。保存するには「保存」ボタンを押してください。', 'success');
            renderUrlList(urlList);
            searchInput.value = '';
        }
        urlInput.value = '';
    });

    // 確認ボタンのイベントリスナー
    checkButton.addEventListener('click', () => {
        const url = urlInput.value.trim();
        if (!url) {
            showMessage('URLを入力してください。', 'error');
            return;
        }
        if (!isValidUrl(url)) {
            showMessage('有効なURLを入力してください。', 'error');
            return;
        }
        if (urlList.includes(url)) {
            showMessage('登録済みのURLです。', 'success');
        } else {
            showMessage('未登録のURLです。', 'info');
        }
        urlInput.value = '';
    });

    // 削除ボタンのイベントリスナー
    deleteButton.addEventListener('click', () => {
        const url = urlInput.value.trim();
        if (!url) {
            showMessage('URLを入力してください。', 'error');
            return;
        }
        const index = urlList.indexOf(url);
        if (index > -1) {
            urlList.splice(index, 1);
            showMessage('URLをリストから削除しました。保存するには「保存」ボタンを押してください。', 'success');
            renderUrlList(urlList);
            searchInput.value = '';
        } else {
            showMessage('指定されたURLは登録されていません。', 'info');
        }
        urlInput.value = '';
    });

    // 保存ボタンのイベントリスナー
    saveButton.addEventListener('click', () => {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');

        const fileName = `urls_${year}-${month}-${day}_${hours}${minutes}${seconds}.json`;
        
        const jsonData = JSON.stringify(urlList, null, 2);
        const blob = new Blob([jsonData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showMessage('JSONファイルがダウンロードされました。', 'success');
    });

    // 検索入力のイベントリスナー
    searchInput.addEventListener('input', (event) => {
        const searchTerm = event.target.value.toLowerCase();
        const filteredList = urlList.filter(url => url.toLowerCase().includes(searchTerm));
        renderUrlList(filteredList);
    });

    // 使い方ガイドの表示/非表示を切り替えるイベントリスナー
    showGuideButton.addEventListener('click', () => {
        guideSection.style.display = 'block';
        showGuideButton.style.display = 'none';
    });
    
    hideGuideButton.addEventListener('click', () => {
        guideSection.style.display = 'none';
        showGuideButton.style.display = 'block';
    });

    // ページの初期表示
    renderUrlList([]);
</script>

</body>
</html>